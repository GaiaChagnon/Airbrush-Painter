# lineart.yaml -- Configuration for the standalone line-art tracer script
#
# Controls vectorization mode, hatching, and flow-imager parameters.
# CLI arguments override any value here.
# Loaded by robot_control/scripts/run_lineart_tracer.py.
#
# Canvas geometry (paper size, origin, margin) is read from jobs.yaml.
# All linear dimensions in millimeters unless stated otherwise.

# Operating mode: "line_tracing", "hatched", "hatching", or "flow_imager"
mode: line_tracing

# --- Physical pen properties ------------------------------------------------
line_width_mm: 0.3                   # Pen trace width on paper (mm)

# --- Line-tracing mode (potrace + vpype) ------------------------------------
# Best for: schematics, text, engineering drawings, maps.
# For maps with light-gray features, increase threshold (try 180-200).
line_tracing:
  turdsize: 10                       # Potrace speckle filter: discard contours
                                     # with area < this many px^2
  merge_tolerance_px: 5.0            # Max px distance for vpype endpoint merging
  simplify_tol_mm: 0.05              # Douglas-Peucker tolerance (mm)
  min_path_mm: 0.5                   # Drop paths shorter than this (mm)
  threshold: null                    # Binary threshold 0-255; null = default 128

# --- Hatched mode (hatched library + vpype) ----------------------------------
# Best for: photos, portraits, illustrations, grayscale art.
hatched:
  pen_width_mm: 0.3                  # Physical pen width (mirrors line_width_mm)

  # Threshold levels (0-255) dividing the grayscale image into zones.
  # 3 thresholds = 4 zones; more levels = smoother gradients.
  levels: [64, 128, 192]

  hatch_pitch_mm: 0.6                # Densest hatching pitch (~2x pen width)
  hatch_angle_deg: 45.0              # Diagonal hatching angle (degrees)
  blur_radius: 10                    # Gaussian blur before thresholding
  image_scale: 1.0                   # Scale factor; reduce for speed
  circular: false                    # true = concentric circles
  invert: false                      # Invert image before processing

  include_outlines: true             # Overlay potrace outlines for crisper edges
  outline_turdsize: 10               # Potrace turdsize for outline overlay
  min_path_mm: 0.3                   # Drop paths shorter than this (mm)
  simplify_tol_mm: 0.05              # Douglas-Peucker tolerance (mm)
  merge_tolerance_px: 5.0            # vpype endpoint merge tolerance (px)

# --- Hatching mode (zone-bounded cross-hatching) ------------------------------
# Best for: maps, diagrams, images with distinct gray regions.
# Auto-detects gray zones from the image histogram and fills each zone with
# hatching lines clipped to its boundary.  Supports cross-hatching (multiple
# angles) and zigzag connection for continuous pen paths.
hatching:
  n_zones: 4                           # Total zones incl. white.  4 = 3 hatched + white
  angles: [45.0]                       # Hatching angles (deg).  [45, -45] = cross-hatch,
                                       # [0, 60, 120] = triple cross
  blur_radius: 5                       # Gaussian blur before zone detection
  image_scale: 1.0                     # Scale factor; reduce for speed
  include_outlines: true               # Overlay potrace outlines on top
  outline_turdsize: 10                 # Potrace turdsize for outlines
  connect_gap_px: 5.0                  # Max px gap for zigzag line connection
  min_path_mm: 0.3                     # Drop paths shorter than this (mm)
  simplify_tol_mm: 0.05                # Douglas-Peucker tolerance (mm)
  merge_tolerance_px: 5.0              # vpype endpoint merge tolerance (px)

# --- Flow-imager mode (vpype-flow-imager) ------------------------------------
# Best for: artistic renderings, stylized reproductions, abstract line art.
# Uses density-modulated flow-field streamlines that follow image brightness.
flow_imager:
  # Flow field generation
  noise_coeff: 0.001                 # Simplex noise frequency; smaller = smoother
  n_fields: 1                        # Rotated field copies; 1=smooth,
                                     # 3=triangular, 4=rectangular, 6=hexagonal
  field_type: noise                  # "noise" (opensimplex) or "curl_noise" (curly)

  # Streamline density and length (in px at max_size resolution)
  min_sep: 0.8                       # Minimum flowline separation (px)
  max_sep: 10.0                      # Maximum flowline separation (px)
  min_length: 0.0                    # Minimum flowline length (px)
  max_length: 40.0                   # Maximum flowline length (px)

  # Image scaling
  max_size: 800                      # Largest side resized to this (px);
                                     # higher = more detail but slower

  # Reproducibility -- all flow seeds identical for consistent results
  flow_seed: 42                      # PRNG seed for flow field construction
  search_ef: 50                      # HNSWlib search accuracy (higher = slower)
  test_frequency: 2.0                # Separation tests per current line spacing

  # Optional field modifiers (null = disabled)
  edge_field_multiplier: null        # Blend edge-following field (try 1.0)
  dark_field_multiplier: null        # Blend dark-curling field (try 1.0)

  # Path post-processing
  min_path_mm: 0.3                   # Drop paths shorter than this (mm)
  simplify_tol_mm: 0.05              # Douglas-Peucker tolerance (mm)
  merge_tolerance_px: 5.0            # vpype endpoint merge tolerance (px)
